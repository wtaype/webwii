import{j as s}from"./vendor-gzd0YkcT.js";import{auth as u,db as l}from"./firebase-DVHtvaaI.js";import{h as U,j as z,k as f,d as m,e as A,q as P,w as R,f as T,l as x,m as j,u as S,n as N,s as b,c as y,p as L}from"./firebase-XdCz69j8.js";import{f as p,h as n,M as c,g as $,s as C}from"./main-DWKjSpF4.js";import{personal as I}from"./header-D2d5M10H.js";import"./main-GjtgUQuo.js";const o={db:"smiles",rol:"smile"},v={"auth/email-already-in-use":"Email ya registrado","auth/weak-password":"Contraseña débil","auth/invalid-credential":"Contraseña incorrecta","auth/invalid-email":"Email no válido","auth/missing-email":"Usuario no registrado","auth/too-many-requests":"Demasiados intentos"},k={regEmail:[a=>a.toLowerCase().trim(),a=>/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/.test(a)||"Email inválido"],regUsuario:[a=>a.toLowerCase().replace(/[^a-z0-9_]/g,"").trim(),a=>a.length>=4||"Mínimo 4 caracteres"],regNombre:[a=>a.trim(),a=>a.length>0||"Ingresa tu nombre"],regApellidos:[a=>a.trim(),a=>a.length>0||"Ingresa tus apellidos"],regPassword:[a=>a,a=>a.length>=6||"Mínimo 6 caracteres"],regPassword1:[a=>a,a=>a===s("#regPassword").val()||"No coinciden"]},d=(a,i,e,t,w=!1)=>`<div class="wilg_grupo"><i class="fas fa-${a}"></i><input type="${i}" id="${e}" placeholder="${t}" autocomplete="off">${w?'<i class="fas fa-eye wilg_ojo"></i>':""}</div>`,V={login:()=>`
    <div class="wilg_head">
      <div class="wilg_logo"><img src="./smile.avif" alt="Awonbe"></div>
      <h2>Bienvenido</h2><p>Inicia sesión en tu cuenta</p>
    </div>
    ${d("envelope","text","email","Email o usuario")}
    ${d("lock","password","password","Contraseña",!0)}
    <button type="button" id="Login" class="wilg_btn inactivo"><i class="fas fa-sign-in-alt"></i> Iniciar Sesión</button>
    <div class="wilg_links">
      
      <span class="wilg_reg">Crear cuenta <i class="fas fa-arrow-right"></i></span>
    </div>`,registrar:()=>`
    <div class="wilg_head">
      <div class="wilg_logo"><img src="./smile.avif" alt="Awonbe"></div>
      <h2>Crear Cuenta</h2><p>Únete a la comunidad</p>
    </div>
    <div class="wilg_grid">
      ${[["envelope","email","regEmail","Email"],["user","text","regUsuario","Usuario"],["user-tie","text","regNombre","Nombre"],["user-tie","text","regApellidos","Apellidos"]].map(([a,i,e,t])=>d(a,i,e,t)).join("")}
      ${d("lock","password","regPassword","Contraseña",!0)}
      ${d("lock","password","regPassword1","Confirmar contraseña",!0)}
    </div>
    <div class="wilg_check">
      <label><input type="checkbox" id="regTerminos">
      <span>Acepto los <a href="/terminos.html" target="_blank">términos y condiciones</a></span></label>
    </div>
    <button type="button" id="Registrar" class="wilg_btn inactivo"><i class="fas fa-user-plus"></i> Registrarme</button>
    <div class="wilg_links"><span class="wilg_log"><i class="fas fa-arrow-left"></i> Ya tengo cuenta</span></div>`,restablecer:()=>`
    <div class="wilg_head">
      <div class="wilg_logo wilg_logo_sm"><img src="./smile.avif" alt="Awonbe"></div>
      <h2>Restablecer</h2><p>Te enviaremos un enlace a tu email</p>
    </div>
    ${d("envelope","text","recEmail","Email o usuario")}
    <button type="button" id="Recuperar" class="wilg_btn inactivo"><i class="fas fa-paper-plane"></i> Enviar enlace</button>
    <div class="wilg_links"><span class="wilg_log"><i class="fas fa-arrow-left"></i> Volver</span></div>`},E=()=>{s("#wimain").html('<div class="wilg_wrap"><div class="wilg_card"><form id="liForm"></form></div></div>'),g("login")},g=a=>{s("#liForm").html(V[a]()).attr("data-vista",a),s("#liForm input:first").focus()},r=a=>s(`#${a}`).val().trim(),_=async a=>{if(a.includes("@"))return a;const i=await f(m(l,o.db,a));if(!i.exists())throw new Error("Usuario no encontrado");return i.data().email},h=async a=>{C("wiSmile",a,24),a?.tema&&a.tema!==localStorage.wiTema&&s(`.tema[data-ths="${a.tema}"]`).trigger("click"),I(a)};s(document).on("click.wi",".wilg_ojo",function(){const a=s(this).siblings("input");a.attr("type",a.attr("type")==="password"?"text":"password"),s(this).toggleClass("fa-eye fa-eye-slash")}).on("input.wi","#email,#recEmail,#regEmail,#regUsuario",function(){s(this).val(s(this).val().toLowerCase())}).on("click.wi",".wilg_reg",()=>g("registrar")).on("click.wi",".wilg_rec",()=>g("restablecer")).on("click.wi",".wilg_log",()=>g("login")).on("input.wi keyup.wi","#password",a=>{s("#Login").removeClass("inactivo"),a.key==="Enter"&&s("#Login").click()}).on("input.wi keyup.wi","#regPassword1",a=>{s("#Registrar").removeClass("inactivo"),a.key==="Enter"&&s("#Registrar").click()}).on("input.wi keyup.wi","#recEmail",a=>{s("#Recuperar").removeClass("inactivo"),a.key==="Enter"&&s("#Recuperar").click()}).on("blur.wi",Object.keys(k).map(a=>`#${a}`).join(","),function(){const[a,i]=k[this.id],e=a(s(this).val());s(this).val(e);const t=i(e);t!==!0&&p(this,t,"error",2500)}).on("blur.wi","#regUsuario",async function(){const a=r("regUsuario");if(a.length<3)return;const i=!(await f(m(l,o.db,a))).exists();s(this).data("ok",i),p(this,`Usuario ${i?"disponible ✅":"no disponible ❌"}`,i?"success":"error",3e3)}).on("blur.wi","#regEmail",async function(){const a=r("regEmail");if(!a.includes("@"))return;const i=(await A(P(T(l,o.db),R("email","==",a)))).empty;s(this).data("ok",i),p(this,`Email ${i?"disponible ✅":"no disponible ❌"}`,i?"success":"error",3e3)}).on("click.wi","#Login",async function(){n(this,!0,"Iniciando");try{await x(u,await _(r("email")),r("password"));const a=(await f(m(l,o.db,u.currentUser.displayName||r("email")))).data();await h(a)}catch(a){c(v[a.code]||a.message,"error")}finally{n(this,!1)}}).on("click.wi","#Registrar",async function(){const i=[[!s("#regTerminos").is(":checked"),"#regTerminos","Acepta los términos"],[!s("#regUsuario").data("ok"),"#regUsuario","Verifica el usuario"],[!s("#regEmail").data("ok"),"#regEmail","Verifica el email"]].find(([e])=>e);if(i)return p(s(i[1])[0],i[2],"error",2500);n(this,!0,"Registrando");try{const e={email:r("regEmail"),usuario:r("regUsuario"),nombre:r("regNombre"),apellidos:r("regApellidos"),password:r("regPassword")},{user:t}=await j(u,e.email,e.password);await Promise.all([S(t,{displayName:e.usuario}),N(t)]);const w={usuario:e.usuario,email:e.email,nombre:e.nombre,apellidos:e.apellidos,rol:o.rol,uid:t.uid,terminos:!0,tema:localStorage.wiTema};await b(m(l,o.db,e.usuario),{...w,creado:y()}),await h(w),c("✅ Cuenta creada. Verifica tu email","success")}catch(e){c(v[e.code]||e.message,"error")}finally{n(this,!1)}}).on("click.wi","#Recuperar",async function(){n(this,!0,"Enviando");try{await L(u,await _(r("recEmail"))),c("✅ Email enviado, revisa tu bandeja","success"),setTimeout(()=>g("login"),2e3)}catch(a){c(v[a.code]||a.message,"error")}finally{n(this,!1)}}).on("click.wi",".tema",async function(){const a=$("wiSmile");a?.usuario&&setTimeout(async()=>{const i=localStorage.wiTema;if(i)try{await b(m(l,o.db,a.usuario),{tema:i,actualizado:y()},{merge:!0}),C("wiSmile",{...a,tema:i},24),c(`Tema ${i.split("|")[0]} guardado <i class="fas fa-check-circle"></i>`,"success")}catch(e){console.error("❌ tema:",e)}},0)});U(u,async a=>{if(!a)return E();const i=$("wiSmile");if(i)return h(i);const e=await f(m(l,o.db,a.displayName||a.email));e.exists()?h(e.data()):E()});export{u as auth,U as onAuthStateChanged,E as render,z as signOut};
